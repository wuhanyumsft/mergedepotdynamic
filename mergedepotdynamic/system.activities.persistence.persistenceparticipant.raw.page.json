{"content":"    \r\n    <h1 id=\"System_Activities_Persistence_PersistenceParticipant\">\r\n      <span class=\"lang-csharp\">PersistenceParticipant</span>\r\n        Class\r\n    </h1>\r\n    \r\n    \r\n    <nav id=\"center-doc-outline\" class=\"doc-outline\" ms.cmpgrp=\"intopic toc\" role=\"navigation\" aria-label=\"On page navigation\">\r\n      <h3>In this Article</h3>\r\n    </nav><div class=\"summary\">\r\n    \t<p>This class allows both <a class=\"xref\" href=\"system.activities.workflowapplication\" data-linktype=\"relative-path\">WorkflowApplication</a> and <a class=\"xref\" href=\"system.servicemodel.workflowservicehost\" data-linktype=\"relative-path\">WorkflowServiceHost</a> to participate in persistence process. A persistence participant derives from the PersistenceParticipant class or the <a class=\"xref\" href=\"system.activities.persistence.persistenceioparticipant\" data-linktype=\"relative-path\">PersistenceIOParticipant</a> class (derived class of the PersistenceParticipant class), implements abstract methods, and then add an instance of the class as a workflow instance extension. The <a class=\"xref\" href=\"system.activities.workflowapplication\" data-linktype=\"relative-path\">WorkflowApplication</a> and <a class=\"xref\" href=\"system.servicemodel.workflowservicehost\" data-linktype=\"relative-path\">WorkflowServiceHost</a> look for such extensions when persisting an instance and invoke appropriate methods at appropriate times.</p>\n\r\n    </div><h2>Syntax</h2>\r\n    \r\n    \t<h3>Declaration</h3>\r\n    \t<pre class=\"memberDeclaration\"><code class=\"csharp lang-csharp\">public abstract class PersistenceParticipant</code></pre>\r\n    \r\n    \r\n    \r\n    <h3>Inheritance Hierarchy</h3>\r\n    <ul class=\"inheritance\">\r\n        <li class=\"l0\">\r\n          <div class=\"lang-csharp\">\r\n            <a class=\"xref\" href=\"system.object\" data-linktype=\"relative-path\">System.Object</a>\r\n          </div>\r\n        </li>\r\n      <li class=\"l1\">\r\n        <div class=\"xref\">\r\n          <div class=\"lang-csharp\">PersistenceParticipant</div>\r\n        </div>\r\n      </li>\r\n    </ul>\r\n    \r\n      <div class=\"referencebox inheritedMembers\">\r\n        <h3>Inherited Members</h3>\r\n        <h4></h4>\r\n          <div class=\"lang-csharp\">\r\n            <a class=\"xref\" href=\"system.object#System_Object_Equals_System_Object_\" data-linktype=\"relative-path\">Equals(Object)</a>\r\n          </div>\r\n          , \r\n          <div class=\"lang-csharp\">\r\n            <a class=\"xref\" href=\"system.object#System_Object_Equals_System_Object_System_Object_\" data-linktype=\"relative-path\">Equals(Object,Object)</a>\r\n          </div>\r\n          , \r\n          <div class=\"lang-csharp\">\r\n            <a class=\"xref\" href=\"system.object#System_Object_GetHashCode\" data-linktype=\"relative-path\">GetHashCode()</a>\r\n          </div>\r\n          , \r\n          <div class=\"lang-csharp\">\r\n            <a class=\"xref\" href=\"system.object#System_Object_GetType\" data-linktype=\"relative-path\">GetType()</a>\r\n          </div>\r\n          , \r\n          <div class=\"lang-csharp\">\r\n            <a class=\"xref\" href=\"system.object#System_Object_MemberwiseClone\" data-linktype=\"relative-path\">MemberwiseClone()</a>\r\n          </div>\r\n          , \r\n          <div class=\"lang-csharp\">\r\n            <a class=\"xref\" href=\"system.object#System_Object_ReferenceEquals_System_Object_System_Object_\" data-linktype=\"relative-path\">ReferenceEquals(Object,Object)</a>\r\n          </div>\r\n          , \r\n          <div class=\"lang-csharp\">\r\n            <a class=\"xref\" href=\"system.object#System_Object_ToString\" data-linktype=\"relative-path\">ToString()</a>\r\n          </div>\r\n          \r\n      </div>\r\n    \r\n    \r\n      <h2>Remarks</h2>\r\n      <p>A host executes the following steps (or stages) when persisting an instance:  </p>\n<ol>\n<li><p>Collects values to be persisted.  </p>\n</li>\n<li><p>Maps fields of monolithic structured values to individual values.  </p>\n</li>\n<li><p>Issues the <a class=\"xref\" href=\"system.activities.durableinstancing.saveworkflowcommand\" data-linktype=\"relative-path\">SaveWorkflowCommand</a> to the persistence provider.  </p>\n</li>\n<li><p>Performs I/O under the persistence transaction.  </p>\n<p>A host completes a stage before beginning the next stage. For example when persisting, the host collects values from all the persistence participants before moving to the second stage. In the second stage, the host provides all the values collected in the first stage to all persistence participants in the second stage for mapping. In the third stage, the host provides all the collected values in the first and second stages to the persistence provider when invoking the <a class=\"xref\" href=\"system.activities.durableinstancing.saveworkflowcommand\" data-linktype=\"relative-path\">SaveWorkflowCommand</a>. Then in the fourth stage, the host provides all the collected values to all the persistence IO participants under the persistence transaction.  </p>\n<p>A host executes the following stages when loading a persistence instance:  </p>\n</li>\n<li><p>Issues the <a class=\"xref\" href=\"system.activities.durableinstancing.loadworkflowcommand\" data-linktype=\"relative-path\">LoadWorkflowCommand</a> and <a class=\"xref\" href=\"system.activities.durableinstancing.loadworkflowbyinstancekeycommand\" data-linktype=\"relative-path\">LoadWorkflowByInstanceKeyCommand</a> to the persistence provider.  </p>\n</li>\n<li><p>Performs I/O under the persistence transaction.  </p>\n</li>\n<li><p>Publishes the loaded values.  </p>\n<p>At the highest level, workflow instance extensions that derive from the PersistenceParticipant class can participate in the first (Collect) and second (Map) stages of persisting process and the third stage (Publish) of loading process.  Workflow instance extensions deriving from the PersistenceIOParticipant class can additionally participate in the fourth stage of the persisting process and the second stage of the loading process (I/O).</p>\n</li>\n</ol>\n\r\n    \r\n    \r\n    <h2>Constructors\r\n     summary</h2>\r\n    \r\n    <table class=\"nameValue\">\r\n        <tr class=\" enable-platform-filter\">\r\n          <td>\r\n            <div class=\"lang-csharp\"><a href=\"#System_Activities_Persistence_PersistenceParticipant__ctor\" data-linktype=\"self-bookmark\">PersistenceParticipant()</a></div>\r\n          </td>\r\n            <td>\r\n            <p>Initializes an instance of the <a class=\"xref\" href=\"system.activities.persistence.persistenceparticipant\" data-linktype=\"relative-path\">PersistenceParticipant</a> class.</p>\n\r\n            </td>\r\n        </tr>\r\n    </table>\r\n    <h2>Methods\r\n     summary</h2>\r\n    \r\n    <table class=\"nameValue\">\r\n        <tr class=\" enable-platform-filter\">\r\n          <td>\r\n            <div class=\"lang-csharp\"><a href=\"#System_Activities_Persistence_PersistenceParticipant_CollectValues_System_Collections_Generic_IDictionary_System_Xml_Linq_XName_System_Object___System_Collections_Generic_IDictionary_System_Xml_Linq_XName_System_Object___\" data-linktype=\"self-bookmark\">CollectValues(IDictionary&lt;XName,Object&gt;,IDictionary&lt;XName,Object&gt;)</a></div>\r\n          </td>\r\n            <td>\r\n            <p>A host invokes this method on a custom persistence participant to collect read-write values and write-only values, to be persisted.</p>\n\r\n            </td>\r\n        </tr>\r\n        <tr class=\" enable-platform-filter\">\r\n          <td>\r\n            <div class=\"lang-csharp\"><a href=\"#System_Activities_Persistence_PersistenceParticipant_MapValues_System_Collections_Generic_IDictionary_System_Xml_Linq_XName_System_Object__System_Collections_Generic_IDictionary_System_Xml_Linq_XName_System_Object__\" data-linktype=\"self-bookmark\">MapValues(IDictionary&lt;XName,Object&gt;,IDictionary&lt;XName,Object&gt;)</a></div>\r\n          </td>\r\n            <td>\r\n            <p>A host invokes this method after it is done with collecting the values in the first stage. The host forwards two read-only dictionaries of values it collected from all persistence participants during the first stage (CollectValues stage) to this method for mapping. The host adds values in the dictionary returned by this method to the collection of write-only values.</p>\n\r\n            </td>\r\n        </tr>\r\n        <tr class=\" enable-platform-filter\">\r\n          <td>\r\n            <div class=\"lang-csharp\"><a href=\"#System_Activities_Persistence_PersistenceParticipant_PublishValues_System_Collections_Generic_IDictionary_System_Xml_Linq_XName_System_Object__\" data-linktype=\"self-bookmark\">PublishValues(IDictionary&lt;XName,Object&gt;)</a></div>\r\n          </td>\r\n            <td>\r\n            <p>The host invokes this method and passes all the loaded values in the <span class=\"xref\">stem.Activities.Persistence.SaveWorkflowCommand.InstanceData*</span> collection (filled by the <span class=\"xref\">stem.Activities.Persistence.LoadWorkflowCommand</span> or <span class=\"xref\">stem.Activities.Persistence.LoadWorkflowByInstanceKeyCommand</span>) as a dictionary parameter.</p>\n\r\n            </td>\r\n        </tr>\r\n    </table>\r\n    <section class=\"memberGroup\">\r\n      <header class=\"header enable-platform-filter\" id=\"constructors\">\r\n        <h2>Constructors\r\n    </h2>\r\n      </header>\r\n    \r\n      <ul class=\"list-clean enable-platform-filter\">\r\n    \r\n        <li class=\" enable-platform-filter\" id=\"System_Activities_Persistence_PersistenceParticipant__ctor\">\r\n    \r\n            <a id=\"System_Activities_Persistence_PersistenceParticipant__ctor_\"></a>\r\n    \r\n    \r\n          <div class=\"memberName\">\r\n            <div class=\"lang-csharp\">PersistenceParticipant()</div>        \r\n          </div>\r\n    \r\n            <p>Initializes an instance of the <a class=\"xref\" href=\"system.activities.persistence.persistenceparticipant\" data-linktype=\"relative-path\">PersistenceParticipant</a> class.</p>\n\r\n    \r\n            <pre class=\"memberDeclaration\"><code class=\"csharp lang-csharp\">protected PersistenceParticipant ();</code></pre>\r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n          \r\n    \r\n    \r\n            <h4>Example</h4>\r\n            <p>The following code sample demonstrates creating a class that derives from <a class=\"xref\" href=\"system.activities.persistence.persistenceparticipant\" data-linktype=\"relative-path\">PersistenceParticipant</a>. This example is from the <a href=\"../Topic/Hiring%20Process.md\" data-linktype=\"relative-path\">Hiring Process</a> sample.  </p>\n<pre><code class=\"lang-cs\" name=\"wfs_HiringRequestProcess#1\">public class HiringRequestInfoPersistenceParticipant: PersistenceIOParticipant\n{\n    public HiringRequestInfoPersistenceParticipant()\n        : base(true, false)\n    {\n    }\n</code></pre>\r\n    \r\n    \r\n        </li>\r\n      </ul>\r\n    </section><section class=\"memberGroup\">\r\n      <header class=\"header enable-platform-filter\" id=\"methods\">\r\n        <h2>Methods\r\n    </h2>\r\n      </header>\r\n    \r\n      <ul class=\"list-clean enable-platform-filter\">\r\n    \r\n        <li class=\" enable-platform-filter\" id=\"System_Activities_Persistence_PersistenceParticipant_CollectValues_System_Collections_Generic_IDictionary_System_Xml_Linq_XName_System_Object___System_Collections_Generic_IDictionary_System_Xml_Linq_XName_System_Object___\">\r\n    \r\n            <a id=\"System_Activities_Persistence_PersistenceParticipant_CollectValues_\"></a>\r\n    \r\n    \r\n          <div class=\"memberName\">\r\n            <div class=\"lang-csharp\">CollectValues(IDictionary&lt;XName,Object&gt;,IDictionary&lt;XName,Object&gt;)</div>        \r\n          </div>\r\n    \r\n            <p>A host invokes this method on a custom persistence participant to collect read-write values and write-only values, to be persisted.</p>\n\r\n    \r\n            <pre class=\"memberDeclaration\"><code class=\"csharp lang-csharp\">protected virtual void CollectValues (out System.Collections.Generic.IDictionary&lt;System.Xml.Linq.XName,object&gt; readWriteValues, out System.Collections.Generic.IDictionary&lt;System.Xml.Linq.XName,object&gt; writeOnlyValues);</code></pre>\r\n    \r\n    \r\n              <h4>Parameters</h4>\r\n              <ul class=\"memberDetails\">\r\n                <li>\r\n                  <dl>\r\n                  <dt>readWriteValues</dt>\r\n                  <dd>\r\n                    <div class=\"lang-csharp\"><a class=\"xref\" href=\"system.collections.generic.idictionary-2\" data-linktype=\"relative-path\">IDictionary</a>&lt;<a class=\"xref\" href=\"system.xml.linq.xname\" data-linktype=\"relative-path\">XName</a>,<a class=\"xref\" href=\"system.object\" data-linktype=\"relative-path\">Object</a>&gt;</div>\r\n                  </dd>\r\n                  </dl>\r\n                  <p>The read-write values to be persisted.</p>\n\r\n                </li>\r\n                <li>\r\n                  <dl>\r\n                  <dt>writeOnlyValues</dt>\r\n                  <dd>\r\n                    <div class=\"lang-csharp\"><a class=\"xref\" href=\"system.collections.generic.idictionary-2\" data-linktype=\"relative-path\">IDictionary</a>&lt;<a class=\"xref\" href=\"system.xml.linq.xname\" data-linktype=\"relative-path\">XName</a>,<a class=\"xref\" href=\"system.object\" data-linktype=\"relative-path\">Object</a>&gt;</div>\r\n                  </dd>\r\n                  </dl>\r\n                  <p>The write-only values to be persisted.</p>\n\r\n                </li>\r\n              </ul>\r\n    \r\n    \r\n    \r\n    \r\n          \r\n    \r\n            <h4>Remarks</h4>\r\n            <p>The host packages read-write values in the first dictionary as &lt;xref:System.Runtime.Persistence.InstanceValue&gt; objects of an &lt;xref:System.Activities.Persistence.SaveWorkflowCommand.InstanceData%2A&gt; collection, and packages write-only values in the second dictionary as &lt;xref:System.Runtime.Persistence.InstanceValue&gt; objects with &lt;xref:System.Runtime.Persistence.InstanceValueOptions.Optional&gt; and &lt;xref:System.Runtime.Persistence.InstanceValueOptions.WriteOnly&gt; flags set. For more information, see&lt;xref:System.Runtime.Persistence.InstanceValueOptions&gt;.  </p>\n<div class=\"IMPORTANT\"><h5>Important</h5><p> Each value provided by implementations of CollectValues across all persistence participants within one persistence episode must have a unique XName.</p>\n</div>\n\r\n    \r\n            <h4>Example</h4>\r\n            <p>The following code sample demonstrates using CollectValues in a class that derives from <a class=\"xref\" href=\"system.activities.persistence.persistenceparticipant\" data-linktype=\"relative-path\">PersistenceParticipant</a>. This example is from the <a href=\"../Topic/Persistence%20Participants.md\" data-linktype=\"relative-path\">Persistence Participants</a> sample.  </p>\n<pre><code class=\"lang-cs\" name=\"wfs_PersistenceParticipants#2\">public class StepCountExtension : PersistenceParticipant\n{\n    static XNamespace stepCountNamespace = XNamespace.Get(&quot;urn:schemas-microsoft-com:Microsoft.Samples.WF/WorkflowInstances/properties&quot;);\n    static XName currentCountName = stepCountNamespace.GetName(&quot;CurrentCount&quot;);\n\n    int currentCount;\n\n    public int CurrentCount\n    {\n        get\n        {\n            return this.currentCount;\n        }\n    }\n\n    internal void IncrementStepCount()\n    {\n        this.currentCount += 1;\n    }\n\n    protected override void CollectValues(out IDictionary&lt;XName, object&gt; readWriteValues, out IDictionary&lt;XName, object&gt; writeOnlyValues)\n    {\n        readWriteValues = new Dictionary&lt;XName, object&gt;(1) { { currentCountName, this.currentCount } };\n        writeOnlyValues = null;\n    }\n\n    protected override void PublishValues(IDictionary&lt;XName, object&gt; readWriteValues)\n    {\n        object loadedData;\n        if (readWriteValues.TryGetValue(currentCountName, out loadedData))\n        {\n            this.currentCount = (int)loadedData;\n        }\n    }\n}\n</code></pre>\r\n    \r\n    \r\n        </li>\r\n        <li class=\" enable-platform-filter\" id=\"System_Activities_Persistence_PersistenceParticipant_MapValues_System_Collections_Generic_IDictionary_System_Xml_Linq_XName_System_Object__System_Collections_Generic_IDictionary_System_Xml_Linq_XName_System_Object__\">\r\n    \r\n            <a id=\"System_Activities_Persistence_PersistenceParticipant_MapValues_\"></a>\r\n    \r\n    \r\n          <div class=\"memberName\">\r\n            <div class=\"lang-csharp\">MapValues(IDictionary&lt;XName,Object&gt;,IDictionary&lt;XName,Object&gt;)</div>        \r\n          </div>\r\n    \r\n            <p>A host invokes this method after it is done with collecting the values in the first stage. The host forwards two read-only dictionaries of values it collected from all persistence participants during the first stage (CollectValues stage) to this method for mapping. The host adds values in the dictionary returned by this method to the collection of write-only values.</p>\n\r\n    \r\n            <pre class=\"memberDeclaration\"><code class=\"csharp lang-csharp\">protected virtual System.Collections.Generic.IDictionary&lt;System.Xml.Linq.XName,object&gt; MapValues (System.Collections.Generic.IDictionary&lt;System.Xml.Linq.XName,object&gt; readWriteValues, System.Collections.Generic.IDictionary&lt;System.Xml.Linq.XName,object&gt; writeOnlyValues);</code></pre>\r\n    \r\n    \r\n              <h4>Parameters</h4>\r\n              <ul class=\"memberDetails\">\r\n                <li>\r\n                  <dl>\r\n                  <dt>readWriteValues</dt>\r\n                  <dd>\r\n                    <div class=\"lang-csharp\"><a class=\"xref\" href=\"system.collections.generic.idictionary-2\" data-linktype=\"relative-path\">IDictionary</a>&lt;<a class=\"xref\" href=\"system.xml.linq.xname\" data-linktype=\"relative-path\">XName</a>,<a class=\"xref\" href=\"system.object\" data-linktype=\"relative-path\">Object</a>&gt;</div>\r\n                  </dd>\r\n                  </dl>\r\n                  <p>The read-write values to be persisted.</p>\n\r\n                </li>\r\n                <li>\r\n                  <dl>\r\n                  <dt>writeOnlyValues</dt>\r\n                  <dd>\r\n                    <div class=\"lang-csharp\"><a class=\"xref\" href=\"system.collections.generic.idictionary-2\" data-linktype=\"relative-path\">IDictionary</a>&lt;<a class=\"xref\" href=\"system.xml.linq.xname\" data-linktype=\"relative-path\">XName</a>,<a class=\"xref\" href=\"system.object\" data-linktype=\"relative-path\">Object</a>&gt;</div>\r\n                  </dd>\r\n                  </dl>\r\n                  <p>The write-only values to be persisted.</p>\n\r\n                </li>\r\n              </ul>\r\n    \r\n              <h4>Returns</h4>\r\n              <ul class=\"memberDetails\">\r\n                <li>\r\n                  <div class=\"single\">                \r\n                      <div class=\"lang-csharp\"><a class=\"xref\" href=\"system.collections.generic.idictionary-2\" data-linktype=\"relative-path\">IDictionary</a>&lt;<a class=\"xref\" href=\"system.xml.linq.xname\" data-linktype=\"relative-path\">XName</a>,<a class=\"xref\" href=\"system.object\" data-linktype=\"relative-path\">Object</a>&gt;</div>\r\n                  </div>\r\n                  <p>A dictionary containing additional write-only values to be persisted.</p>\n\r\n                </li>\r\n              </ul>\r\n    \r\n    \r\n    \r\n          \r\n    \r\n            <h4>Remarks</h4>\r\n            <p>Each value provided by implementations of all the MapValues methods across all persistence participants including all the values collected in the first stage (CollectValues stage) must have a unique XName.</p>\n\r\n    \r\n            <h4>Example</h4>\r\n            <p>The following code sample demonstrates using MapValues in a class that derives from <a class=\"xref\" href=\"system.activities.persistence.persistenceparticipant\" data-linktype=\"relative-path\">PersistenceParticipant</a>. This example is from the <a href=\"../Topic/Corporate%20Purchase%20Process.md\" data-linktype=\"relative-path\">Corporate Purchase Process</a> sample.  </p>\n<pre><code class=\"lang-cs\" name=\"wfs_PurchaseProcess#2\">class XmlPersistenceParticipant : PersistenceParticipant\n{\n    const string propertiesNamespace = &quot;urn:schemas-microsoft-com:System.Activities/4.0/properties&quot;;\n    private Guid Id;\n\n    public XmlPersistenceParticipant(Guid id)\n    {\n        Id = id;\n    }\n\n    //Add any additional necessary data to persist here\n    protected override void CollectValues(out IDictionary&lt;XName, object&gt; readWriteValues, out IDictionary&lt;XName, object&gt; writeOnlyValues)\n    {\n        base.CollectValues(out readWriteValues, out writeOnlyValues);\n    }\n\n    //Implementations of MapValues are given all the values collected from all participants&#226;€™ implementations of CollectValues\n    protected override IDictionary&lt;XName, object&gt; MapValues(IDictionary&lt;XName, object&gt; readWriteValues, IDictionary&lt;XName, object&gt; writeOnlyValues)\n    {\n        XName statusXname = XName.Get(&quot;Status&quot;, propertiesNamespace);\n\n        IDictionary&lt;XName, object&gt; mappedValues = base.MapValues(readWriteValues, writeOnlyValues);\n\n        RequestForProposal requestForProposal = null;\n        string status = string.Empty;\n        object value = null;\n\n        //retrieve the status of the workflow\n        if (writeOnlyValues.TryGetValue(statusXname, out value))\n        {\n            status = (string)value;\n        }\n\n        //retrieve the RequestForProposal object\n        foreach (KeyValuePair&lt;System.Xml.Linq.XName, object&gt; item in writeOnlyValues)\n        {\n            if (item.Value is LocationInfo)\n            {\n                LocationInfo li = (LocationInfo)item.Value;\n                if (li.Value is RequestForProposal)\n                {\n                    requestForProposal = (RequestForProposal)li.Value;\n                }\n            }\n        }\n\n        IOHelper.EnsureAllRfpFileExists();\n\n        // load the document\n        XElement doc = XElement.Load(IOHelper.GetAllRfpsFileName());\n\n        IEnumerable&lt;XElement&gt; current =\n                                from r in doc.Elements(&quot;requestForProposal&quot;)\n                                where r.Attribute(&quot;id&quot;).Value.Equals(Id.ToString())\n                                select r;\n\n        if (status == &quot;Closed&quot;)\n        {\n            // erase nodes for the current rfp                    \n            foreach (XElement xe in current)\n            {\n                xe.Attribute(&quot;status&quot;).Value = &quot;finished&quot;;\n            }\n        }\n        else\n        {\n            // erase nodes for the current rfp                    \n            foreach (XElement xe in current)\n            {\n                xe.Remove();\n            }\n\n            // get the Xml version of the Rfp, add it to the document and save it\n            if (requestForProposal != null)\n            {\n                XElement e = SerializeRfp(requestForProposal, Id);\n                doc.Add(e);\n            }\n        }\n\n        doc.Save(IOHelper.GetAllRfpsFileName());\n\n        return mappedValues;\n    }\n</code></pre>\r\n    \r\n    \r\n        </li>\r\n        <li class=\" enable-platform-filter\" id=\"System_Activities_Persistence_PersistenceParticipant_PublishValues_System_Collections_Generic_IDictionary_System_Xml_Linq_XName_System_Object__\">\r\n    \r\n            <a id=\"System_Activities_Persistence_PersistenceParticipant_PublishValues_\"></a>\r\n    \r\n    \r\n          <div class=\"memberName\">\r\n            <div class=\"lang-csharp\">PublishValues(IDictionary&lt;XName,Object&gt;)</div>        \r\n          </div>\r\n    \r\n            <p>The host invokes this method and passes all the loaded values in the <span class=\"xref\">stem.Activities.Persistence.SaveWorkflowCommand.InstanceData*</span> collection (filled by the <span class=\"xref\">stem.Activities.Persistence.LoadWorkflowCommand</span> or <span class=\"xref\">stem.Activities.Persistence.LoadWorkflowByInstanceKeyCommand</span>) as a dictionary parameter.</p>\n\r\n    \r\n            <pre class=\"memberDeclaration\"><code class=\"csharp lang-csharp\">protected virtual void PublishValues (System.Collections.Generic.IDictionary&lt;System.Xml.Linq.XName,object&gt; readWriteValues);</code></pre>\r\n    \r\n    \r\n              <h4>Parameters</h4>\r\n              <ul class=\"memberDetails\">\r\n                <li>\r\n                  <dl>\r\n                  <dt>readWriteValues</dt>\r\n                  <dd>\r\n                    <div class=\"lang-csharp\"><a class=\"xref\" href=\"system.collections.generic.idictionary-2\" data-linktype=\"relative-path\">IDictionary</a>&lt;<a class=\"xref\" href=\"system.xml.linq.xname\" data-linktype=\"relative-path\">XName</a>,<a class=\"xref\" href=\"system.object\" data-linktype=\"relative-path\">Object</a>&gt;</div>\r\n                  </dd>\r\n                  </dl>\r\n                  <p>The read-write values that were loaded from the persistence store. This dictionary corresponds to the dictionary of read-write values persisted in the most recent persistence episode.</p>\n\r\n                </li>\r\n              </ul>\r\n    \r\n    \r\n    \r\n    \r\n          \r\n    \r\n    \r\n            <h4>Example</h4>\r\n            <p>The following code sample demonstrates using PublishValues in a class that derives from <a class=\"xref\" href=\"system.activities.persistence.persistenceparticipant\" data-linktype=\"relative-path\">PersistenceParticipant</a>. This example is from the <a href=\"../Topic/Persistence%20Participants.md\" data-linktype=\"relative-path\">Persistence Participants</a> sample.  </p>\n<pre><code class=\"lang-cs\" name=\"wfs_PersistenceParticipants#2\">public class StepCountExtension : PersistenceParticipant\n{\n    static XNamespace stepCountNamespace = XNamespace.Get(&quot;urn:schemas-microsoft-com:Microsoft.Samples.WF/WorkflowInstances/properties&quot;);\n    static XName currentCountName = stepCountNamespace.GetName(&quot;CurrentCount&quot;);\n\n    int currentCount;\n\n    public int CurrentCount\n    {\n        get\n        {\n            return this.currentCount;\n        }\n    }\n\n    internal void IncrementStepCount()\n    {\n        this.currentCount += 1;\n    }\n\n    protected override void CollectValues(out IDictionary&lt;XName, object&gt; readWriteValues, out IDictionary&lt;XName, object&gt; writeOnlyValues)\n    {\n        readWriteValues = new Dictionary&lt;XName, object&gt;(1) { { currentCountName, this.currentCount } };\n        writeOnlyValues = null;\n    }\n\n    protected override void PublishValues(IDictionary&lt;XName, object&gt; readWriteValues)\n    {\n        object loadedData;\n        if (readWriteValues.TryGetValue(currentCountName, out loadedData))\n        {\n            this.currentCount = (int)loadedData;\n        }\n    }\n}\n</code></pre>\r\n    \r\n    \r\n        </li>\r\n      </ul>\r\n    </section>\r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n","outputRootRelativePath":"./","pageMetadata":"<meta name=\"breadcrumb_path\" content=\"breadcrumb/toc.json\">\r\n<meta name=\"search.ms_sitename\" content=\"Docs\">\r\n<meta name=\"search.ms_docsetname\" content=\"fulldocset\">\r\n<meta name=\"locale\" content=\"en-us\">\r\n<meta name=\"site_name\" content=\"Docs\">\r\n<meta name=\"search.ms_product\" content=\"MSDN\">\r\n<meta name=\"depot_name\" content=\"MSDN.fulldocset\">\r\n<meta name=\"ref_skeleton_gitcommit\" content=\"https://github.com/TianqiZhang/ECMA2YamlTestRepo2/blob/501959ac03e19ac52a27aa4c6bbeb980f8b11c8c/fulldocset/System.Activities.Persistence.PersistenceParticipant.yml\">\r\n<meta name=\"original_ref_skeleton_git_url\" content=\"https://github.com/TianqiZhang/ECMA2YamlTestRepo2/blob/master/fulldocset/System.Activities.Persistence.PersistenceParticipant.yml\">\r\n<meta name=\"APIName\" content=\"System.Activities.Persistence.PersistenceParticipant\">\r\n<meta name=\"APIName\" content=\"System.Activities.Persistence.PersistenceParticipant..ctor\">\r\n<meta name=\"APIName\" content=\"System.Activities.Persistence.PersistenceParticipant.CollectValues\">\r\n<meta name=\"APIName\" content=\"System.Activities.Persistence.PersistenceParticipant.MapValues\">\r\n<meta name=\"APIName\" content=\"System.Activities.Persistence.PersistenceParticipant.PublishValues\">\r\n<meta name=\"APILocation\" content=\"System.Activities.dll\">\r\n<meta name=\"TopicType\" content=\"apiref\">\r\n<meta name=\"APIType\" content=\"Assembly\">\r\n<meta name=\"updated_at\" content=\"2017-03-01 01:37 AM\">\r\n<meta name=\"document_id\" content=\"c1cc4898-2d9b-dd16-993b-6e986f0f9d7b\">\r\n<meta name=\"pagetype\" content=\"Reference\">\r\n<meta name=\"description\" content=\"This class allows both  and  to participate in persistence process. A persistence participant derives from the PersistenceParticipant class or the  class (derived class of the PersistenceParticipant…\">\r\n<meta name=\"toc_rel\" content=\"_splitted/System.Activities.Persistence/toc.json\">\r\n<meta name=\"source_url\" content=\"\">\r\n<meta name=\"ms.assetid\" content=\"System.Activities.Persistence.PersistenceParticipant\">\r\n","rawMetadata":{"breadcrumb_path":"breadcrumb/toc.json","search.ms_sitename":"Docs","search.ms_docsetname":"fulldocset","version":null,"_op_canonicalUrlPrefix":"https://ppe.docs.microsoft.com/en-us/fulldotnet/","locale":"en-us","site_name":"Docs","search.ms_product":"MSDN","_op_openToPublicContributors":true,"depot_name":"MSDN.fulldocset","_op_gitRefSkeletonCommitHistory":[{"author_name":"Tianqi Zhang","author_email":"tianzh@microsoft.com","committer_name":"Tianqi Zhang","comitter_email":"tianzh@microsoft.com","message":"use plugin in master","commit_sha":"501959ac03e19ac52a27aa4c6bbeb980f8b11c8c","commit_date":"2017-03-01 09:31:20 +0800"},{"author_name":"Tianqi Zhang","author_email":"tianzh@microsoft.com","committer_name":"Tianqi Zhang","comitter_email":"tianzh@microsoft.com","message":"switch from platform to version","commit_sha":"78cdacb5ca782478af490a6b30c3a2cb2b6b873e","commit_date":"2017-02-28 15:09:51 +0800"},{"author_name":"Tianqi Zhang","author_email":"tianzh@microsoft.com","committer_name":"Tianqi Zhang","comitter_email":"tianzh@microsoft.com","message":"update platforms","commit_sha":"39ad5a8919a59afc93a79ac4bd8e07c3b471b37a","commit_date":"2017-02-28 10:38:59 +0800"},{"author_name":"Tianqi Zhang","author_email":"tianzh@microsoft.com","committer_name":"Tianqi Zhang","comitter_email":"tianzh@microsoft.com","message":"checkin yml","commit_sha":"da161b792852497df7140d7768cee2eccd9cb43f","commit_date":"2017-02-28 09:36:15 +0800"},{"author_name":"Tianqi Zhang","author_email":"tianzh@microsoft.com","committer_name":"Tianqi Zhang","comitter_email":"tianzh@microsoft.com","message":"delete ymls","commit_sha":"417c04fd1daf0cb211ec4909020356fc1fe69260","commit_date":"2017-02-27 14:12:48 +0800"},{"author_name":"Tianqi Zhang","author_email":"tianzh@microsoft.com","committer_name":"Tianqi Zhang","comitter_email":"tianzh@microsoft.com","message":"update latest xml","commit_sha":"1e40a158586a88a698e0cb5342785002a56898b2","commit_date":"2017-02-24 16:20:57 +0800"},{"author_name":"Tianqi Zhang","author_email":"tianzh@microsoft.com","committer_name":"Tianqi Zhang","comitter_email":"tianzh@microsoft.com","message":"transform see cref and fix paramref format","commit_sha":"3d0ea34483c97ac77f4020a7f294757d67a5c1d4","commit_date":"2017-02-23 10:03:17 +0800"},{"author_name":"Tianqi Zhang","author_email":"tianzh@microsoft.com","committer_name":"Tianqi Zhang","comitter_email":"tianzh@microsoft.com","message":"fix param transform, fix escaped xref","commit_sha":"2af997a764c82488dfa824f1c7bc4d736757d943","commit_date":"2017-02-22 17:04:48 +0800"},{"author_name":"Tianqi Zhang","author_email":"tianzh@microsoft.com","committer_name":"Tianqi Zhang","comitter_email":"tianzh@microsoft.com","message":"convert exceptions","commit_sha":"0a5bf3370731dd35a596c91081e5dc82e2eace3a","commit_date":"2017-02-22 11:54:30 +0800"},{"author_name":"Tianqi Zhang","author_email":"tianzh@microsoft.com","committer_name":"Tianqi Zhang","comitter_email":"tianzh@microsoft.com","message":"remove _yml from url","commit_sha":"f9314af8858edb8c329d223328490093aef4f55f","commit_date":"2017-02-17 15:31:12 +0800"}],"ref_skeleton_gitcommit":"https://github.com/TianqiZhang/ECMA2YamlTestRepo2/blob/501959ac03e19ac52a27aa4c6bbeb980f8b11c8c/fulldocset/System.Activities.Persistence.PersistenceParticipant.yml","original_ref_skeleton_git_url":"https://github.com/TianqiZhang/ECMA2YamlTestRepo2/blob/master/fulldocset/System.Activities.Persistence.PersistenceParticipant.yml","open_to_public_contributors":true,"api_name":["System.Activities.Persistence.PersistenceParticipant","System.Activities.Persistence.PersistenceParticipant..ctor","System.Activities.Persistence.PersistenceParticipant.CollectValues","System.Activities.Persistence.PersistenceParticipant.MapValues","System.Activities.Persistence.PersistenceParticipant.PublishValues"],"api_location":["System.Activities.dll"],"topic_type":["apiref"],"api_type":["Assembly"],"f1_keywords":["System.Activities.Persistence.PersistenceParticipant","System::Activities::Persistence::PersistenceParticipant","System.Activities.Persistence.PersistenceParticipant.#ctor","System::Activities::Persistence::PersistenceParticipant::#ctor","System.Activities.Persistence.PersistenceParticipant.CollectValues","System::Activities::Persistence::PersistenceParticipant::CollectValues","System.Activities.Persistence.PersistenceParticipant.MapValues","System::Activities::Persistence::PersistenceParticipant::MapValues","System.Activities.Persistence.PersistenceParticipant.PublishValues","System::Activities::Persistence::PersistenceParticipant::PublishValues"],"dev_langs":["csharp"],"updated_at":"2017-03-01 01:37 AM","document_id":"c1cc4898-2d9b-dd16-993b-6e986f0f9d7b","content_git_url":"https://github.com/TianqiZhang/ECMA2YamlTestRepo2/blob/master/fulldocset/xml/System.Activities.Persistence/PersistenceParticipant.xml","layout":"Reference","_op_layout":"Reference","pagetype":"Reference","title":"PersistenceParticipant class | Microsoft Docs","_op_ogTitle":"PersistenceParticipant class","description":"This class allows both  and  to participate in persistence process. A persistence participant derives from the PersistenceParticipant class or the  class (derived class of the PersistenceParticipant…","toc_asset_id":"_splitted/System.Activities.Persistence/toc.json","toc_rel":"_splitted/System.Activities.Persistence/toc.json","source_url":"","ms.assetid":"System.Activities.Persistence.PersistenceParticipant","canonical_url":"https://ppe.docs.microsoft.com/en-us/mergedepotdynamic/system.activities.persistence.persistenceparticipant","_op_canonicalUrl":"https://ppe.docs.microsoft.com/en-us/mergedepotdynamic/system.activities.persistence.persistenceparticipant","fileRelativePath":"System.Activities.Persistence.PersistenceParticipant.html"},"themesRelativePathToOutputRoot":"_themes/"}